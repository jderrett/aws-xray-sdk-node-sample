# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/introduction/learn-gitpod/gitpod-yaml)
# and commit this file to your remote git repository to share the goodness with others.

# Learn more from ready-to-use templates: https://www.gitpod.io/docs/introduction/getting-started/quickstart

tasks:
  # Install AWS Xray daemon
  - name: Dev Server
    init: |
      npm install
      cd .. && mkdir xray-install-files && cd xray-install-files
      wget https://s3.us-east-2.amazonaws.com/aws-xray-assets.us-east-2/xray-daemon/aws-xray-daemon-3.x.deb
      sudo apt-get install ./aws-xray-daemon-3.x.deb
      cd $GITPOD_REPO_ROOT
      gp sync-done xray
    command: node index.js
  # Run xray daemon
  # Config lives in /etc/amazon/xray/cfg.yaml
  - name: AWS XRay Daemon
    init: gp sync-await xray
    command: |
      cd ../xray-install-files
      xray -o # skip EC2 check

ports:
  - port: 2000
    onOpen: ignore
  - port: 3000
    onOpen: open-browser
